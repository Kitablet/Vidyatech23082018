@using FISE_Cloud.Models;
@model Report6
@{
    ViewBag.Title = Resource.Reports_Report6_Title;
    ViewBag.HeaderPageTitle = "Reports";
    FISE_Cloud.Services.Authentication.UserData _Userdata = null;
    var IsUserAuthenticated = FISEAuthenticationService.IsUserAuthenticated;
    if (IsUserAuthenticated)
    {
        _Userdata = FISEAuthenticationService.CurrentUserData;
    }
  
    
}
<div class="row title-section">
    <div>
        @if (Html.MvcSiteMap().SiteMap.CurrentNode != Html.MvcSiteMap().SiteMap.RootNode)
        {
            @Html.MvcSiteMap().SiteMapPath("BootstrapSiteMapPathHelperModel")
        }
    </div>

    <div class="col-xs-12">
        <h4 class="page-title">
            @if (_Userdata != null && _Userdata.Role.Equals("schooladmin", StringComparison.InvariantCultureIgnoreCase))
            {
                @Resource.Reports_Schooladmin_Report5_Title
                ViewBag.Title = Resource.Reports_Schooladmin_Report5_Title;
            }
            else
            {
                @Resource.Reports_Report6_Title
            }
         <a class="exporttoexcel" id="report6_exptoexcel" title="@Resource.Export_Reports_Report6"></a>
        </h4>
    </div>
</div>
<hr />
@using (Html.BeginForm("ExportReport6", "Report", FormMethod.Post, new { id = "filter-selected-items-toexport-form" }))
{
    <input type="hidden" id="SubSectionIds" name="SubSectionIds" value="" />
    <input type="hidden" id="LanguageIds" name="LanguageIds" value="" />
}


@using (Ajax.BeginForm("Report6", "Report", null, new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "Books", OnBegin = "onBegin", OnComplete = "onComplete" }, new { id = "filterForm" }))
{
    
        <span id="modifyfilter_link" class="accordion_plus">@Resource.Reports_ModifyFiltersandRegenerateReport</span>
    
        <div id="filter_accordion" class="collapse in">
            <div class="row reportfilter-row">
                <div class="col-xs-12"><p class="report_subtitle">@Resource.Reports_SelectLibrarySubsections</p></div>
                <div class="col-xs-12">
                    <div class="col-xs-12">
                        <input type="checkbox" id="selectall_sec" value="All" checked />
                        <span class="filter_checkboxlabel2">@Resource.checkbox_SelectAll</span>
                    </div>
                    <hr class="hr_report" />
                    @foreach (var item in Model.Subsections)
                    {
                        <div class="col-xs-12 reportfilter_check">
                            <input type="checkbox" name="subsections" value="@item.Id" />
                            <span class="filter_checkboxlabel2">@item.Name</span>
                        </div>

                    }

                </div>
            </div>

            <div class="row reportfilter-row">
                <div class="col-xs-12"><p class="report_subtitle">@Resource.Reports_SelectLanguages</p></div>
                <div class="col-xs-12">
                    <div class="col-xs-12">
                        <input type="checkbox" id="selectall_lang" value="All" checked />
                        <span class="filter_checkboxlabel2">@Resource.checkbox_SelectAll</span>
                    </div>
                    <hr class="hr_report" />
                    @foreach (var item in Model.Languages)
                    {
                        <div class="col-xs-12 reportfilter_check">
                            <input type="checkbox" name="languages" value="@item.Id" />
                            <span class="filter_checkboxlabel2">@item.Name</span>
                        </div>

                    }
                </div>
            </div>

            <div class="buttons">
                <input type="submit" class="btn btn-default btn-rect" data-toggle="collapse" data-target="#filter_accordion" value="@Resource.Reports_btn_GenerateReport" id="btn_GenerateReport" />
            </div>
        </div>
        <div id="Books">

        </div>
        }

        @section scripts
{
            <script src="~/Scripts/jquery.unobtrusive-ajax.min.js?v=1"></script>
            <script>
                $('#report6_exptoexcel').click(function () {
                    if ($('#selectall_sec').prop('checked'))
                        $('#SubSectionIds').val('');
                    else {
                        var ids = [];
                        $('[name=subsections]:checked').each(function () {
                            ids.push($(this).val());
                        });
                        $('#SubSectionIds').val(ids.join(','));
                    }

                    if ($('#selectall_lang').prop('checked'))
                        $('#LanguageIds').val('');
                    else {
                        var ids = [];
                        $('[name=languages]:checked').each(function () {
                            ids.push($(this).val());
                        });
                        $('#LanguageIds').val(ids.join(','));
                    }
                    $('#filter-selected-items-toexport-form').submit();
                    return false;
                });

                $('#selectall_sec').click(function () {
                   $(this).prop('checked',true) 
                        $('[name=subsections]').prop('checked', false);
                });
                $('#selectall_lang').click(function () {
                    $(this).prop('checked', true);
                        $('[name=languages]').prop('checked', false);
                    
                });
                $('[name=languages]').click(function () {
                    if ($('[name=languages]').length == $('[name=languages]:checked').length) {
                        $('[name=languages]').prop('checked', false);
                        $('#selectall_lang').prop('checked', true);
                    }
                    else if ($('[name=languages]:checked').length == 0)
                        $('#selectall_lang').prop('checked', true);
                    else {
                        $('#selectall_lang').prop('checked', false);
                    }
                });

                $('[name=subsections]').click(
                   function () {
                       if ($('[name=subsections]').length == $('[name=subsections]:checked').length) {
                           $('[name=subsections]').prop('checked', false);
                           $('#selectall_sec').prop('checked', true);
                       }
                       else if ($('[name=subsections]:checked').length == 0)
                           $('#selectall_sec').prop('checked', true);
                       else {
                           $('#selectall_sec').prop('checked', false);
                       }
                   });

                $('#filter_accordion').on('hidden.bs.collapse', function () {
                    $('span#modifyfilter_link').show();
                    $('#Books').addClass("in");
                    $('#report6_exptoexcel').css('display', 'inline-flex');                    
                });

                $('span#modifyfilter_link').click(function () {
                    $('span#modifyfilter_link').hide();
                    $('#filter_accordion').addClass("in");
                    $('#filter_accordion').css('height', 'auto');
                });
                function onBegin() {
                    displayAjaxLoading(true);
                }
                function onComplete(jqXHR, textStatus, err) {
                   
                    if (jqXHR.status == 401) {
                        //refresh the page, as we are not longer authorized
                        location.reload();
                    }
                    displayAjaxLoading(false);
                    $('html, body').animate({ scrollTop: 0 }, 500);
                }
            </script>
        }
